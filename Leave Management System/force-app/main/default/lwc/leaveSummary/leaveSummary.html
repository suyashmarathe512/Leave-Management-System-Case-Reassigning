<template>
    <!-- SIDEBAR CONTAINER -->
<div class="sidebar-container">
    <!-- Closed sidebar button -->
    <div class="sidebar-toggle-button" onclick={toggleSidebar} title="My Open Cases" aria-label="My Open Cases">
        <lightning-icon icon-name="standard:case" size="small"></lightning-icon>
    </div>
    <!-- Expanding Sidebar Drawer -->
    <aside if:true={isSidebarOpen} class="sidebar-expanded">
        <div class="drawer-header">
            <h3>My Open Cases</h3>
            <lightning-button-icon icon-name="utility:close" onclick={closeSidebar}></lightning-button-icon>
        </div>
        <div class="drawer-body">
            <!-- OPEN CASES -->
            <div class="drawer-section">
                <template if:true={formattedCases}>
                    <template if:true={formattedCases.length}>
                        <template for:each={formattedCases} for:item="c">
                            <div class="case-item" key={c.Id} onclick={navigateToRecord} data-id={c.Id}>
                                <div class="item-title">{c.Subject}</div>
                                <div class="item-meta">{c.CaseNumber} â€¢ {c.Status}</div>
                            </div>
                        </template>
                    </template>
                </template>
                <template if:true={casesError}>
                    <div class="empty">Error loading cases</div>
                </template>
            </div>
            <!-- PAST LEAVES -->
            <div class="drawer-section divider">
                <h3><strong> Past Leaves</strong> </h3>
                <template if:true={pastLeaves}>
                    <template if:true={pastLeaves.length}>
                        <template for:each={pastLeaves} for:item="leave">
                            <div class="case-item small" key={leave.Id}>
                                <div class="item-title">{leave.formattedDate}</div>
                                <div class="item-meta">{leave.Status__c}</div>
                            </div>
                        </template>
                    </template>
                </template>
            </div>

        </div>
    </aside>
</div>
    <div class={contentClass}>
        <!--  LEAVE BALANCE CARDS -->
        <div class="slds-m-bottom_medium" style="flex: 0 0 auto;margin-left: 1%;">
            <lightning-layout multiple-rows="true" pull-to-boundary="small">
                <!--  Balance -->
                <lightning-layout-item size="12" medium-device-size="6" large-device-size="3" padding="around-small">
                    <div class="dashboard-card">
                        <div class="card-icon-row">
                            <span class="card-title">Annual Balance</span>
                            <div class="icon-box blue"><lightning-icon icon-name="utility:date_input" size="small"></lightning-icon></div>
                        </div>
                        <div class="card-stat">
                            <div class="stat-label">Available</div>
                            <div class="stat-value">{earned} Earned / {sick} Sick</div>
                        </div>
                    </div>
                </lightning-layout-item>
                <!-- Booked -->
                <lightning-layout-item size="12" medium-device-size="6" large-device-size="3" padding="around-small">
                    <div class="dashboard-card">
                        <div class="card-icon-row">
                            <span class="card-title">Booked Leaves</span>
                            <div class="icon-box green"><lightning-icon icon-name="utility:event" size="small"></lightning-icon></div>
                        </div>
                        <div class="card-stat">
                            <div class="stat-label">Booked</div>
                            <div class="stat-value">{bookedEarned} Earned / {bookedSick} Sick</div>
                        </div>
                    </div>
                </lightning-layout-item>
                <!--  Available -->
                <lightning-layout-item size="12" medium-device-size="6" large-device-size="3" padding="around-small">
                    <div class="dashboard-card">
                        <div class="card-icon-row">
                            <span class="card-title">Available Leaves</span>
                            <div class="icon-box purple"><lightning-icon icon-name="utility:check" size="small"></lightning-icon></div>
                        </div>
                        <div class="card-stat">
                            <div class="stat-label">Remaining</div>
                            <div class="stat-value">{availableEarned} Earned / {availableSick} Sick</div>
                        </div>
                    </div>
                </lightning-layout-item>
                <!--  Unpaid -->
                <lightning-layout-item size="12" medium-device-size="6" large-device-size="3" padding="around-small">
                    <div class="dashboard-card">
                        <div class="card-icon-row">
                            <span class="card-title">Unpaid Leaves</span>
                            <div class="icon-box red"><lightning-icon icon-name="utility:money" size="small"></lightning-icon></div>
                        </div>
                        <div class="card-stat">
                            <div class="stat-label">Total Taken</div>
                            <div class="stat-value">{bookedUnpaid} Days</div>
                        </div>
                    </div>
                </lightning-layout-item>
            </lightning-layout>
        </div>
        <div class="lists-wrapper">
        <!-- UPCOMING LEAVES -->
        <div class="list-container">
            <div class="list-header">
                <h2>Upcoming Leaves</h2>
                <lightning-button-icon icon-name="utility:add" variant="border-filled" onclick={handleApplyLeave} alternative-text="Apply"></lightning-button-icon>
            </div>
            <template if:true={upcomingLeaves.length}>
                <ul class="leave-list">
                    <template for:each={upcomingLeaves} for:item="leave">
                        <li key={leave.Id} class="leave-row">
                            <!-- Left: Date -->
                            <div class="col-date">
                                {leave.formattedDate}
                            </div>
                            <!-- Type & Days -->
                            <div class="col-type">
                                <span class={leave.dotClass}></span>
                                <span class="leave-type">{leave.typeLabel}</span>
                                <span class="leave-duration">{leave.durationLabel}</span>
                            </div>
                            <!-- Reason -->
                            <div class="col-reason" title={leave.Reason_To_Leave__c}>{leave.Reason_To_Leave__c}</div>
                            <!-- Status -->
                            <div class="col-status">
                                <span class={leave.statusClass}>{leave.Status__c}</span>
                            </div>
                        </li>
                    </template>
                </ul>
            </template>
            <template if:false={upcomingLeaves.length}>
                <div class="empty-state">No upcoming leaves.</div>
            </template>
        </div>
        <!--PAST LEAVES -->
        <div class="list-container">
            <div class="list-header">
                <h2>Past Leaves</h2>
            </div>
            <template if:true={pastLeaves.length}>
                <ul class="leave-list">
                    <template for:each={pastLeaves} for:item="leave">
                        <li key={leave.Id} class="leave-row">
                            <div class="col-date">
                                {leave.formattedDate}
                            </div>
                            <div class="col-type">
                                <span class={leave.dotClass}></span>
                                <span class="leave-type">{leave.typeLabel}</span>
                                <span class="leave-duration">{leave.durationLabel}</span>
                            </div>
                            <div class="col-reason" title={leave.Reason_To_Leave__c}>{leave.Reason_To_Leave__c}</div>
                            <div class="col-status">
                                <span class={leave.statusClass}>{leave.Status__c}</span>
                            </div>
                        </li>
                    </template>
                </ul>
            </template>
            <template if:false={pastLeaves.length}>
                <div class="empty-state">No past leave history.</div>
            </template>
        </div>
        </div>
    </div>
</template>